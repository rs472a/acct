import{a as O,g as G,h as R,m as N,n as A}from"./chunk-O77Q3CZS.js";import{Ja as S,Ka as T,La as E,N as v,S as y,W as I,Xa as L,_a as C,d as k,ja as f,ua as w,za as j}from"./chunk-EMA27O36.js";var F=(()=>{let o=class o{constructor(){typeof localStorage<"u"?this.storage=localStorage:typeof sessionStorage<"u"?this.storage=sessionStorage:console.log("Web Storage is not supported in this environment.")}set(e,t){this.storage!=null&&this.storage.setItem(e,t)}get(e){if(this.storage!=null){let t=this.storage.getItem(e),i=JSON.parse(t);return t}}remove(e){this.storage!=null&&this.storage.removeItem(e)}clear(){this.storage!=null&&this.storage.clear()}key(e){if(this.storage!=null)return this.storage.key(e)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"});let h=o;return h})();var M=(()=>{let o=class o{constructor(e,t,i){this.storage=e,this.http=t,this.document=i,this.eventLoadedGAPI=new f,this.eventLoaded=new f,this.eventLogin=new f,this.eventGet=new f,this.discovery="https://sheets.googleapis.com/$discovery/rest?version=v4",this.scopes=["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/docs","https://www.googleapis.com/auth/drive","https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.readonly","https://www.googleapis.com/auth/spreadsheets","https://www.googleapis.com/auth/spreadsheets.readonly"],this.gisLoaded=!1,this.gapiLoaded=!1,this.login=!1,this.converter={tsvToObj:a=>{let n=[];a.split(`\r
`).forEach(l=>{let r=[];l.split("	").forEach(u=>r.push(u)),n.push(r)});let p=[],d=n[0];return n.filter((l,r)=>r>0).forEach(l=>{let r={};l.forEach((g,u)=>{let s=d[u];r[s]=g}),p.push(r)}),p},listToObj:a=>{let n=[],p=a[0];return a.forEach((d,l)=>{let r={};d.forEach((g,u)=>{r[p[u]]=g}),l>0&&n.push(r)}),n}},this.anon={read:a=>{this.http.get(a,{responseType:"text"}).subscribe(n=>{let p=this.converter.tsvToObj(n);this.eventGet.emit(p)})},create:(a,n)=>{function p(){let s="";return d.forEach(m=>{s+=`${m.name}=${m.value}&`}),s=s.substring(0,s.length-1),s}n.preventDefault();let d=[],l=n.currentTarget;l.querySelectorAll("[name]").forEach(s=>{if(["radio","checkbox"].includes(s.type)&&!s.checked)return;let m={id:s.id,name:s.name,value:s.value};if(s.type=="date"){let b=new Date(s.value);d.push({id:s.id,name:s.name+"_year",value:b.getFullYear()}),d.push({id:s.id,name:s.name+"_month",value:b.getMonth()+1}),d.push({id:s.id,name:s.name+"_day",value:b.getDay()})}else d.push(m)});let g=p(),u=`https://docs.google.com/forms/d/e/${a}/formResponse?${g}&submit=Submit`;l.reset(),this.http.request("GET",u).subscribe()}},this.sheets={getBatch:(a,n)=>{let p=typeof this.tokenClient<"u"?"gis":"gapi",d=()=>{gapi.client.sheets.spreadsheets.values.batchGet({spreadsheetId:a,ranges:n,valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"FORMATTED_STRING"}).then(l=>{let r=l.result.valueRanges;r.forEach((g,u)=>{let s=/.+[!]/gm.exec(g.range)[0].replace("!",""),m=this.converter.listToObj(g.values);r[u].sheetName=s,r[u].list=m}),this.eventGet.emit(r)}).catch(l=>{throw l})};p=="gis"?this.gisCall(l=>d()):d()}};let c=e.get("gid");c!=null&&c!=null&&(this.identity=JSON.parse(c))}importGAPI(e){if(this.gapiLoaded)return this.onLoadedScript("gapi");this.apiKey=e,this.importScript("https://apis.google.com/js/api.js",()=>{gapi.load("client",()=>k(this,null,function*(){yield gapi.client.init({apiKey:this.apiKey,discoveryDocs:[this.discovery]}),this.onLoadedScript("gapi")}))})}importGSI(e,t=!1){if(this.gisLoaded){this.onLoadedScript("gis"),(!this.login||t)&&this.loginGis(t);return}this.clientId=e,this.importScript("https://accounts.google.com/gsi/client",()=>{this.loginGis(t),this.gisLoaded=!0,this.onLoadedScript("gis")})}onLoadedScript(e){switch(e){case"gapi":this.gapiLoaded=!0,this.eventLoadedGAPI.emit();break;case"gis":this.gisLoaded=!0;break;default:break}this.gapiLoaded&&this.gisLoaded&&this.eventLoaded.emit()}loginGis(e=!1){google.accounts.id.initialize({client_id:this.clientId,scope:this.scopes.join(" "),callback:i=>this.handleCredentialResponse(i)}),this.tokenClient=google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:this.scopes.join(" "),callback:""});function t(){let i=document.getElementById("g-overlay"),c=document.getElementById("buttonDiv");if(i==null&&c==null){i=document.createElement("div"),i.id="g-overlay",i.className="position-fixed bg-black bg-opacity-75 start-0 top-0 vw-100 vh-100 z-3",i.style.backdropFilter="blur(10px)";let a=document.createElement("div");a.className="d-flex justify-content-center align-items-center h-100",c=document.createElement("div"),c.id="buttonDiv",a.append(c),i.append(a),document.body.append(i)}i?.classList.toggle("d-none",!1),google.accounts.id.renderButton(c,{theme:"outline",size:"large"})}!this.login||e?(t(),google.accounts.id.prompt()):this.handleCredentialResponse()}signOut(){let e=gapi.client.getToken();e!==null&&(google.accounts.oauth2.revoke(e.access_token),gapi.client.setToken(""),this.login=!1)}gisCall(e){this.tokenClient.callback=i=>{if(i.error!==void 0)throw i;this.accessToken=i,typeof e<"u"&&e(i)},this.accessToken==null?this.tokenClient.requestAccessToken({prompt:""}):typeof e<"u"&&e(this.accessToken)}handleCredentialResponse(e){let t;if(e!=null){t=this.parseJwt(e.credential);let i=document.getElementById("g-overlay");this.identity=t,this.storage.set("gid",JSON.stringify(t)),this.login=!0,i?.classList.toggle("d-none",!0)}this.eventLogin.emit(t)}parseJwt(e){var t=e.split(".")[1],i=t.replace(/-/g,"+").replace(/_/g,"/"),c=decodeURIComponent(window.atob(i).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(c)}importScript(e,t,i,c){let a=this.document.body,n=this.document.createElement("script");n.innerHTML="",n.src=e,c!=null&&(n.crossOrigin=c),i!=null&&(n.integrity=i),n.async=!0,n.defer=!0,n.onload=t,a.appendChild(n)}};o.\u0275fac=function(t){return new(t||o)(y(F),y(R),y(O))},o.\u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"});let h=o;return h})();var V=(()=>{let o=class o{constructor(e,t,i){this.sheets=e,this.zone=t,this.router=i,this.app={title:"Workshop Title",shortTitle:"WT",img:""},this.auth={api:"AIzaSyAFphG2uvgMhVxwN_jX-D8lFWe18Smw27Q",client:"793065333568-iqu12vtn7n0diq9v2ovrdgovhtq8po7i.apps.googleusercontent.com"},this.userReset()}ngOnInit(){this.initUser()}initUser(){this.sheets.eventLogin.subscribe(t=>{this.zone.run(()=>{t==null?this.sheets.loginGis(!0):(this.user=t,this.router.navigate(["main/home"]))})});let e=this.auth;this.sheets.importGAPI(e.api),this.sheets.importGSI(e.client,!1)}userReset(){this.user={sub:"",email:"",family_name:"",given_name:"",name:"Anonymous",picture:"https://t3.ftcdn.net/jpg/05/53/79/60/360_F_553796090_XHrE6R9jwmBJUMo9HKl41hyHJ5gqt9oz.jpg"}}tracker(e,t){return t}};o.\u0275fac=function(t){return new(t||o)(w(M),w(j),w(A))},o.\u0275cmp=I({type:o,selectors:[["app-root"]],standalone:!0,features:[C],decls:4,vars:0,consts:[[1,"position-fixed","bottom-0","z-1000","opacity-50","w-100","text-center"]],template:function(t,i){t&1&&(E(0,"router-outlet"),S(1,"footer",0)(2,"small"),L(3," \xA9 Kananda Saputra (2024) "),T()())},dependencies:[N,G]});let h=o;return h})();export{V as a};
